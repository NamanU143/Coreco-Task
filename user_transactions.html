<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Transactions</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-center mb-4">User Transactions</h2>
        <p id="userMessage" class="text-danger text-center"></p>
        <table class="table table-bordered table-striped" id="transactionsTable" style="display: none;">
            <thead>
                <tr>
                    <th>Transaction No.</th>
                    <th>Asset Name</th>
                    <th>From User</th>
                    <th>To User</th>
                    <th>Transfer Date</th>
                </tr>
            </thead>
            <tbody id="transactionsTableBody">
                <!-- Transactions will be added dynamically -->
            </tbody>
        </table>
        <a href="users.html" class="btn btn-secondary mt-3">Back to Users List</a>
    </div>

    <script>
        async function fetchUserTransactions() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get("user_id");

            if (!userId) {
                document.getElementById("userMessage").textContent = "No user ID provided!";
                return;
            }

            try {
                let response = await fetch(`http://localhost:3000/get_user_transactions/${userId}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                let data = await response.json();

                if (data.userExists && data.transactions.length > 0) {
                    let tableBody = document.getElementById("transactionsTableBody");
                    tableBody.innerHTML = ""; // Clear old data

                    data.transactions.forEach((transaction, index) => {
                        let row = `
                            <tr>
                                <td>${index + 1}</td> <!-- Continuous transaction number -->
                                <td>${transaction.asset_name}</td>
                                <td>${transaction.from_user}</td>
                                <td>${transaction.to_user}</td>
                                <td>${transaction.transfer_date}</td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });

                    document.getElementById("transactionsTable").style.display = "table";
                } else {
                    document.getElementById("userMessage").textContent = data.message || "No transactions found.";
                }
            } catch (error) {
                console.error("Error fetching user transactions:", error);
                document.getElementById("userMessage").textContent = "Failed to load transactions.";
            }
        }

        document.addEventListener("DOMContentLoaded", fetchUserTransactions);
    </script>
</body>
</html>
